# de-project-sprint-2 - Marketplace DWH

## План проекта
### Шаг 1. Подключение к базе

**Модель данных:**
![image](https://github.com/mamaewapolya/de-project-sprint-2/assets/100092806/58cd024c-cd2b-48aa-bb31-2532d320ec59)

- В схеме dwh — таблицы измерений для мастеров ручной работы (d_craftsman), заказчиков (d_customer) и товаров (d_product). Также там есть таблица фактов о продажах (f_order), инкрементальная витрина по мастерам за отчётные периоды (craftsman_report_datamart) и MATERIALIZED VIEW с отчётом продаж по всему маркетплейсу (orders_report_materialized_view).
- В схеме source1 — широкая таблица первого источника craft_market_wide.
- В схеме source2 — две ненормализованные таблицы: таблица мастеров и товаров (craft_market_masters_products) и таблица заказчиков и заказов (craft_market_orders_customers).
- В схеме source3 — три таблицы: мастеров (craft_market_craftsmans), заказчиков (craft_market_customers), заказов с товарами (craft_market_orders).
- Схема external_source — новая. Там как раз находятся таблицы нового источника, которые нужно подключить к хранилищу.

### Шаг 2. Изучение данных нового источника
- Изучить данные в источнике. Там указаны две таблицы: в одной данные по мастерам, товарам и заказам (craft_products_orders), а в другой — только по заказчикам (customers).
- Разложить данные по измерениям в хранилище.
- Настроить передачу данных из новой схемы external_source в dwh. 

### Шаг 3. Создание скрипта переноса данных из источника в хранилище
Данные должны попасть в схему dwh по тому же принципу, что и из схем source1, source2, source3. Нужно дополнить скрипт загрузки данных из старых источников новым источником. 

### Шаг 4. Изучить потребности бизнеса в новой витрине
Исследовать хранилище на соответствие данных. Посмотреть, какие данные понадобятся для создания DDL новой витрины. 
Бизнесу требуются следующие данные:
- идентификатор записи;
- идентификатор заказчика;
- Ф. И. О. заказчика;
- адрес заказчика;
- дата рождения заказчика;
- электронная почта заказчика;
- сумма, которую потратил заказчик;
- сумма, которую заработала платформа от покупок заказчика за месяц (10% от суммы, которую потратил заказчик);
- количество заказов у заказчика за месяц;
- средняя стоимость одного заказа у заказчика за месяц;
- медианное время в днях от момента создания заказа до его завершения за месяц;
- самая популярная категория товаров у этого заказчика за месяц;
- идентификатор самого популярного мастера ручной работы у заказчика. Если заказчик сделал одинаковое количество заказов у нескольких мастеров, возьмите любого;
- количество созданных заказов за месяц;
- количество заказов в процессе изготовки за месяц;
- количество заказов в доставке за месяц;
- количество завершённых заказов за месяц;
- количество незавершённых заказов за месяц;
- отчётный период, год и месяц.

### Шаг 5. DDL новой витрины
- Создать DDL для витрины dwh.customer_report_datamart, определив типы, названия полей и комментарии.
- Витрина инкрементальная, поэтому необходимо создать дополнительную таблицу с датой загрузки данных.

### Шаг 6. Инкрементальное обновление витрины
Написать скрипт, который будет выполнять расчёт для новой витрины.
